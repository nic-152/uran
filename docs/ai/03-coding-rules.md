# AI Context: Coding Rules

## Обязательные правила для ИИ-кодогенерации

1. База данных
- Всегда использовать PostgreSQL + `sqlx` для новых backend-фич.
- Не вводить ORM.
- SQL-миграции являются источником правды для схемы.

2. Rust backend
- Запрещено использовать `unwrap()` и `expect()` в production-коде.
- Всегда возвращать осмысленные HTTP-ошибки в JSON формате `{ "error": "..." }`.
- Валидацию входа делать на уровне handler/service до записи в БД.
- Для новых модулей применять разбиение по слоям: `handlers` / `services` / `repositories`.

3. Работа с данными тестирования
- Скриншоты IP-камер хранить как файлы (или object storage), а не Base64 в БД.
- В БД хранить только метаданные файла и ссылку/ключ хранения.

4. Frontend
- Источник правды для проектных данных — API/БД, не localStorage.
- localStorage допустим только для некритичных UI-настроек (тема, локальные фильтры и т.п.).

5. API-контракты
- Любой новый endpoint документировать в `docs/ai/01-architecture.md` и при необходимости в `docs/ai/02-database.md`.
- Для несовместимых изменений указывать migration notes в описании PR.

6. Атомарные коммиты документации
- Любое изменение бизнес-логики, API, схемы БД или стека должно сопровождаться обновлением `docs/ai/` в том же коммите.

7. Commit naming
- Только документация AI: префикс `docs(ai): ...`
- Код + обновление AI docs: использовать основной тип (`feat:`, `fix:` и т.д.) и явно упоминать обновление контекста.
  - Пример: `feat: add run results API + docs(ai): update DB relations`
