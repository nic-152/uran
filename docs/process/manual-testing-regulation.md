# Регламент ручного тестирования IP-камер (Uran)

## 1. Цель
Сделать ручное тестирование управляемым, сравнимым и воспроизводимым.

## 2. Единица работы
- Единица работы инженера: один `Run` по конкретному `Asset`.
- `Asset` включает минимум: модель камеры, версию прошивки, стенд/объект.
- Run создаётся только из шаблона тестов (`run_templates`).

## 3. Уровни покрытия
- `L0 Smoke` — обязательный минимум жизнеспособности.
- `L1 Functional` — основная функциональность.
- `L2 Optional` — модельно-зависимые/расширенные проверки.

Правило:
- без закрытого L0 прогон не может быть `done` или `locked`.

## 4. Definition of Done для Run
Run считается завершённым только если:
- заполнены обязательные поля: проект, asset, инженер, шаблон, версия прошивки, итог;
- по L0 нет пустых пунктов (только `ok/fail/na`);
- для каждого `fail` указаны причина + комментарий (вложение рекомендуется);
- после `done` run переводится в `locked` пользователем с ролью `lead` или `admin`.

После `locked`:
- прямое редактирование запрещено;
- изменения только через новый run или регламентированную корректировку с записью в аудит.

## 5. Причины FAIL
- Причина выбирается из справочника (`fail_reasons`), не свободным текстом.
- Комментарий обязателен при неоднозначной ситуации.

Рекомендуемые группы причин:
- RTSP/потоки/кодек/битрейт
- ONVIF/совместимость
- Сеть (DHCP/IPv6/мультикаст/порты)
- Видео (WDR/ночь/шум/смаз)
- События (детекция/ложные срабатывания)
- Запись (SD/NFS/FTP)
- UI/сохранение настроек
- Производительность/перегрев/ребуты

## 6. Правила библиотеки тестов
- Изменение теста — только через новую `testcase_version`.
- Версии, участвовавшие в locked runs, не редактируются.
- Обязательные поля теста: шаги, ожидаемый результат, теги, уровень покрытия (`L0/L1/L2`).

## 7. Выполнение прогона (операционный протокол)
- Создать run из шаблона.
- Проверить заполненность контекста (проект/asset/инженер/прошивка).
- Последовательно заполнить результаты по пунктам.
- Для fail: выбрать причину, добавить комментарий, приложить артефакт.
- Перевести run в `done`, затем `locked`.

## 8. Аудит
Обязательно логируются:
- создание/изменение/удаление тестов и версий;
- изменение состава run;
- изменения результатов;
- добавление/удаление вложений;
- изменения ролей/прав;
- переходы `done/locked` и операции lock/unlock.

## 9. Метрики управления
Минимум по людям:
- число завершённых runs;
- число заполненных результатов;
- средняя длительность run;
- число зависших in_progress > N дней.

Минимум по качеству:
- fail-rate по моделям/прошивкам;
- топ причин fail;
- топ тестов по fail;
- тесты с высоким `na`.

## 10. Роли
- `admin`: полный доступ, управление ролями и инцидентами.
- `lead`: управление библиотекой тестов, lock/unlock, контроль процесса.
- `engineer`: выполнение runs и заполнение результатов.
- `viewer`: просмотр отчётов и истории.
